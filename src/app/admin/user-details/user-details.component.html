<div class="container mx-auto p-4">

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-8">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>
    <p class="mt-2">Loading orders...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error && !isLoading" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    {{ error }}
  </div>

  <!-- No Orders -->
  <div *ngIf="!isLoading && !error && userOrders.length === 0" class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded">
    No orders found for this user.
  </div>

  <!-- Orders Table -->
  <div *ngIf="!isLoading && userOrders.length > 0">
    <h1 class="text-2xl font-bold mb-6">Orders for User: {{ capitalizeFirstLetter(userName) }}
</h1>

    <table class="min-w-[70vw] border text-sm text-left text-gray-800 shadow rounded overflow-hidden">
      <thead class="bg-slate-200 text-slate-800 uppercase text-xs">
        <tr>
          <th class="p-2">Images</th>
          <th class="p-2 w-36">Title</th>
          <th class="p-2">Kids</th>
          <th class="p-2">Adults</th>
          <th class="p-2">Order Date</th>
          <th class="p-2">Category</th>
          <th class="p-2">Details</th>
          <th class="p-2">Card Details</th>
          <th class="p-2">Delete</th>
          <th class="p-2">Edit</th>

        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let order of userOrders">
          <ng-container *ngFor="let product of order.products">
            <tr class="border-t">
              <!-- Images -->
              <td class="p-2">
                <div class="relative w-24 h-6">
                  <ng-container *ngFor="let thumb of product.thumbnail; let i = index">
                    <img
                      class="w-6 h-6 rounded-full absolute ring-2 ring-white"
                      [style.left.px]="i * 14"
                      [style.zIndex]="10 + i"
                      [src]="'http://localhost:4000/uploads/' + thumb"
                      alt="Image {{ i + 1 }}"
                    />
                  </ng-container>
                </div>
              </td>

              <!-- Title (truncated) -->
              <td class="p-2 font-semibold w-36 truncate max-w-[144px]">
                {{ product.producttitle }}
              </td>

              <!-- Kids -->
              <td class="p-2 text-center">{{ product.kids_no }}</td>

              <!-- Adults -->
              <td class="p-2 text-center">{{ product.adults_no }}</td>

              <!-- Order Date -->
              <td class="p-2">{{ product.order_date }}</td>

              <!-- Category -->
              <td class="p-2">{{ product.categorie }}</td>
  <!-- <i class="fa-solid fa-trash text-red-600 cursor-pointer" (click)="deleteProduct(p._id)"></i> -->
              <!-- Description Modal Trigger -->
              <td class="p-2">
                <button (click)="openModal(product)" class="text-blue-600 hover:underline text-xs font-medium">
                  View
                </button>
              </td>




              <!-- Card Details Button -->
              <td class="p-2">
                <a [routerLink]="['/admin/carddetails', order.userId]"
                   class="text-blue-600 hover:underline text-xs font-medium">
                  View
                </a>
              </td>
              <td class="p-2 text-center">
  <i
    class="fa-solid fa-trash text-red-600 cursor-pointer hover:text-red-800 transition duration-200 text-sm"
    (click)="deleteProduct(order._id, product._id)">
  </i>
</td>



              <td class="p-2 text-center">
     <i class="fa-solid fa-pen-to-square text-blue-600  cursor-pointer hover:text-red-800 transition duration-200 text-sm"
           (click)="onEdit(order._id)"></i>
           
</td>
   












            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Description Modal -->
<!-- Description Modal -->
<div *ngIf="selectedProduct" class="fixed inset-0 z-50 bg-black bg-opacity-40 flex items-center justify-center">
  <div class="bg-white w-[90vw] max-w-md rounded-lg shadow-lg relative">
    
    <!-- Modal Header -->
    <div class="flex justify-between items-center px-5 py-3 bg-slate-700 text-white rounded-t-lg">
      <h2 class="text-lg font-bold">Product Description</h2>
      <button (click)="closeModal()" class="text-white hover:text-red-200 text-xl font-bold">
        &times;
      </button>
    </div>

    <!-- Modal Body -->
    <div class="px-5 py-4 text-sm text-slate-700">
      {{ selectedProduct.productdescription }}
    </div>

    <!-- Modal Footer -->
    <div class="px-5 py-3 border-t text-right">
      <button (click)="closeModal()" class="px-4 py-2 bg-slate-700 text-white rounded hover:bg-pink-700">
        Close
      </button>
    </div>
    
  </div>
</div>

</div>
