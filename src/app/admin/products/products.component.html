
<ng-container *ngIf="isloader">

<div class="p-3 overflow-y-auto">
  <h2 class="text-2xl font-semibold text-slate-800 mb-4">üìã Product Table</h2>

  <table class="w-[90vw] text-xs bg-white border border-slate-300 rounded-lg shadow-md">
    <thead class="bg-slate-800 text-white">
      <tr>
        <th class="px-2 py-2">Img</th>
        <th class="px-2 py-2">Title</th>
        <th class="px-2 py-2">City</th>
        <th class="px-2 py-2">Cat</th>
        <th class="px-2 py-2">Price</th>
        <th class="px-2 py-2">Adult</th>
        <th class="px-2 py-2">Kids</th>
        <th class="px-2 py-2">Disc %</th>
        <th class="px-2 py-2">Final</th>
        <th class="px-2 py-2">Transfer</th>
        <th class="px-2 py-2">Tour</th>
        <th class="px-2 py-2">Lang</th>
        <th class="px-2 py-2">City Desc</th>
        <th class="px-2 py-2">Product Desc</th>
        <th class="px-2 py-2">Edit</th>
        <th class="px-2 py-2">Delete</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of pagedProducts" class="hover:bg-slate-100 transition">
        <td class="px-2 py-2">
          <div class="w-10 h-10">
            <img [src]="'http://localhost:4000/uploads/' + p.thumbnail[1]"
                 (click)="openModal('images', p.thumbnail)"
                 class="w-full h-full object-contain rounded border cursor-pointer hover:shadow" />
          </div>
        </td>

        <td class="px-2 py-2">
          <span (click)="openModal('text', p.producttitle)"
                class="line-clamp-1 cursor-pointer text-slate-800 hover:text-slate-600">
            {{ p.producttitle | slice:0:15 }}...
          </span>
        </td>

        <td class="px-2 py-2 text-slate-600">{{ p.cityName }}</td>
        <td class="px-2 py-2 text-slate-600">{{ p.categorie }}</td>
        <td class="px-2 py-2 text-green-700 font-semibold">Rs. {{ p.price }}</td>
        <td class="px-2 py-2">{{ p.adultBaseprice }}</td>
        <td class="px-2 py-2">{{ p.kidsBaseprice }}</td>
        <td class="px-2 py-2 text-red-600">{{ p.discountPercentage }}%</td>
        <td class="px-2 py-2 text-green-800 font-semibold">Rs. {{ p.discountedTotal | number:'1.0-0' }}</td>
        <td class="px-2 py-2 text-slate-700">{{ p.transportService }}</td>
        <td class="px-2 py-2 text-slate-700">{{ p.tourService }}</td>
        <td class="px-2 py-2 text-slate-700">{{ p.translatelanguage }}</td>

        <td class="px-2 py-2">
          <span (click)="openModal('description', p.citydescription)"
                class="text-slate-800 cursor-pointer hover:underline">View</span>
        </td>
        <td class="px-2 py-2">
          <span (click)="openModal('description', p.productdescription)"
                class="text-slate-800 cursor-pointer hover:underline">View</span>
        </td>

        <td class="px-2 py-2 text-slate-700">
          <i class="fa-solid fa-pen-to-square text-blue-600 cursor-pointer hover:text-slate-600"
             (click)="onEdit(p._id)"></i>
        </td>

        <td class="px-2 py-2 text-slate-700">
          <i class="fa-solid fa-trash text-red-600 cursor-pointer" (click)="deleteProduct(p._id)"></i>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination Controls -->
  <div class="flex flex-col md:flex-row justify-between items-center gap-4 mt-4">
    <div class="flex items-center gap-3">
      <button (click)="prevPage()" [disabled]="currentPage === 1"
              class="px-4 py-1 bg-slate-200 rounded hover:bg-slate-300 disabled:opacity-50">
        Previous
      </button>
      <span class="text-slate-800 font-bold">Page {{ currentPage }} of {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages"
              class="px-4 py-1 bg-slate-200 rounded hover:bg-slate-300 disabled:opacity-50">
        Next
      </button>
    </div>

    <!-- Items Per Page Dropdown -->
    <div class="flex items-center gap-2">
      <label for="itemsPerPage" class="text-sm font-medium text-slate-700">Products per page:</label>
      <select id="itemsPerPage"
              [(ngModel)]="itemsPerPage"
              (change)="onItemsPerPageChange()"
              class="px-2 py-1 border border-slate-300 rounded focus:outline-none focus:ring-2 focus:ring-slate-500">
        <option *ngFor="let count of [5, 8, 10, 15, 20]" [value]="count">{{ count }}</option>
      </select>
    </div>
  </div>
</div>
</ng-container>


<ng-container *ngIf="!isloader">
  <div class="p-4 place-content-center grid text-xs">
    <div class="max-h-[600px] overflow-y-auto rounded-xl">
      <table class="min-w-full text-left text-[#273F4F] bg-white dark:bg-gray-900 border !border-slate-300 dark:!border-slate-200">
        <thead class="text-[11px] uppercase bg-slate-800 text-white tracking-wider">
            <tr>
        <th class="px-2 py-2">Img</th>
        <th class="px-2 py-2">Title</th>
        <th class="px-2 py-2">City</th>
        <th class="px-2 py-2">Cat</th>
        <th class="px-2 py-2">Price</th>
        <th class="px-2 py-2">Adult</th>
       
      </tr>
        </thead>
        <tbody>
          <tr *ngFor="let skeleton of skeletonArray" class="animate-pulse border-b !border-slate-300">
            <td class="px-3 py-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
                <div class="space-y-1">
                  <div class="w-24 h-3 bg-gray-300 rounded"></div>
                  <div class="w-20 h-2 bg-gray-200 rounded"></div>
                </div>
              </div>
            </td>
            <td class="px-2 py-3"><div class="w-24 h-3 bg-gray-300 rounded"></div></td>
            <td class="px-2 py-3"><div class="w-16 h-3 bg-gray-300 rounded"></div></td>
            <td class="px-2 py-3"><div class="w-20 h-3 bg-gray-300 rounded"></div></td>
            <td class="px-2 py-3"><div class="w-16 h-3 bg-gray-300 rounded"></div></td>
            <td class="px-2 py-3"><div class="w-16 h-3 bg-gray-300 rounded"></div></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</ng-container>


<div *ngIf="modalType" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70">
  <div class="bg-white rounded-xl shadow-2xl max-w-xl w-[90%] max-h-[80vh] overflow-y-auto p-6 relative border-4 border-slate-600">
    <button (click)="closeModal()" class="absolute top-2 right-3 text-slate-600 hover:text-red-500 text-xl font-bold">
      &times;
    </button>

    <div *ngIf="modalType === 'text'" class="text-slate-800 text-base leading-relaxed">
      <h3 class="text-slate-700 font-semibold text-lg mb-2">üìå Full Title</h3>
      <p>{{ modalData }}</p>
    </div>

    <div *ngIf="modalType === 'description'" class="text-slate-700 text-sm">
      <h3 class="text-slate-700 font-semibold text-lg mb-2">üìù Description</h3>
      <p class="whitespace-pre-line">{{ modalData }}</p>
    </div>

    <div *ngIf="modalType === 'images'" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <img *ngFor="let img of modalData"
           [src]="'http://localhost:4000/uploads/' + img"
           class="rounded-md border border-slate-300 shadow-md w-full h-40 object-contain"
           alt="Popup Image" />
    </div>
  </div>
</div>